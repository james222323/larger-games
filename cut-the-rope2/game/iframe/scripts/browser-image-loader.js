!function e(t,r,n){function a(s,i){if(!r[s]){if(!t[s]){var d="function"==typeof require&&require;if(!i&&d)return d(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};t[s][0].call(u.exports,(function(e){return a(t[s][1][e]||e)}),u,u.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../tiny-loader/resource-loader-xhr");let a=null;async function o(e,t,r,n,o){if(void 0===o)throw new Error("Can't decode image without data: "+e);if(null===a)throw new Error("Can't detect offscreen canvas context");const i=new Blob([o],{type:s(t)}),d=await createImageBitmap(i,{premultiplyAlpha:"none"});a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d);const c=new Uint8ClampedArray(r*n*4);return a.readPixels(0,0,r,n,a.RGBA,a.UNSIGNED_BYTE,c),{data:c,bytesPerPixel:4}}function s(e){if(0===e)return"image/webp";if(1===e)return"image/png";if(2===e)return"image/jpeg";throw new Error("Can't detect mime type for format: "+e)}function i(e,t,r,n,a,o){const s={name:e,width:r,height:n,size:t,bytesPerPixel:a,data:o};self.postMessage(s,[s.data.buffer])}function d(e,t,r){console.error("Browser decoding image: "+e+" stopped with error: "+r);const n=r.name+": "+r.message+"\n stack:\n"+r.stack||"no stack";self.postMessage({name:e,size:t,error:n})}self.addEventListener("message",(async e=>{const t=e.data;if(void 0!==t)switch(t.command){case"init":if(a=function(e){if(void 0===e)return null;const t=e.getContext("webgl2");if(null===t)return e.getContext("webgl");return t}(t.canvas),null===a){const e="Can't get offscreen canvas context";return console.error(e),void self.postMessage({error:e})}a.activeTexture(a.TEXTURE0);const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);const r=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,r),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),self.postMessage({command:"ready"});break;case"load":try{const e=new Uint8Array(await(0,n.loadResource)(t.url,"arraybuffer")),r=await o(t.name,t.format,t.width,t.height,e);i(t.name,t.size,t.width,t.height,r.bytesPerPixel,r.data)}catch(e){d(t.name,t.size,e)}break;case"decode":try{const e=await o(t.name,t.format,t.width,t.height,t.data);i(t.name,t.size,t.width,t.height,e.bytesPerPixel,e.data)}catch(e){d(t.name,t.size,e)}break;default:d(t.name,t.size,new Error("Unknown command for worker: "+t.command))}}),!1)},{"../../tiny-loader/resource-loader-xhr":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loadResource=void 0,r.loadResource=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"GET",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Promise(((i,d)=>{const c=new XMLHttpRequest;if(c.open(a,e,!0),c.overrideMimeType("text/plain; charset=x-user-defined"),null!==o)for(const[e,t]of Object.entries(o))c.setRequestHeader(e,t);"function"==typeof c.addEventListener&&(c.addEventListener("progress",(e=>{const t=n||e.total||0;t>0&&r(Math.min(100,Math.round(100*e.loaded/t)))})),c.addEventListener("error",(t=>{d(new Error("Invalid xhr response. Code: "+c.status+"status: "+c.statusText+" url: "+e))}))),c.responseType=t,c.onreadystatechange=()=>{4===c.readyState&&(200===c.status?(r(100),i(c.response)):d(new Error("Invalid xhr response. Code: "+c.status+"status: "+c.statusText+" url: "+e)))},c.send(s)}))}},{}]},{},[1]);