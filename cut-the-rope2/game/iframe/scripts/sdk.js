!function e(t,n,i){function s(r,a){if(!n[r]){if(!t[r]){var d="function"==typeof require&&require;if(!a&&d)return d(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[r]={exports:{}};t[r][0].call(u.exports,(function(e){return s(t[r][1][e]||e)}),u,u.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)s(i[r]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getAspectRatio=n.getSizeWithAspectRatio=void 0,n.getSizeWithAspectRatio=function(e,t,n){if(e/t===n)return{width:e,height:t};const i=Math.round(t*n);return i<=e?{width:i,height:t}:{width:e,height:Math.round(e/n)}},n.getAspectRatio=function(e,t,n){const i=9/16;if(void 0===e)return i;const[s,o]=t>n?[t,n]:[n,t],r={landscape:s/o,portrait:o/s},a=(e,t)=>null==t?void 0:Math.min(Math.max(e,t.min),t.max),d=a(r.landscape,e.landscape),l=a(r.portrait,e.portrait);return(t>n?d??l:l??d)??i}},{}],2:[function(e,t,n){"use strict";function i(e,t){const n=e.lastIndexOf("/")+1;let i=e.lastIndexOf("?");return-1===i&&(i=e.length),e.substr(0,n)+t+"/"+e.substr(n,i-n)+"."+t+e.substr(i,e.length-i)}Object.defineProperty(n,"__esModule",{value:!0}),n.canUseCompressionForUrl=n.changeToCompressedUrl=void 0,n.changeToCompressedUrl=async function(e,t){const n=e.host,[s,o]=await Promise.all([n.caniuseBrotli(t),n.caniuseGzip(t)]);return s?i(t,"br"):o?i(t,"gz"):t},n.canUseCompressionForUrl=function(e){return-1!==e.indexOf("bin.")&&e.endsWith("")}},{}],3:[function(e,t,n){"use strict";async function i(e,t,n){""===n&&(n="text");try{if("json"===n)throw new Error("Unspported response type 'json'");return await e.loadResource(t,n)}catch(n){const i="ERR! Can't download "+t+", status: "+n.status+", context: "+n.message;throw e.module.onerror&&e.module.onerror(i),e.log(i),n}}async function s(e,t,n,i,s){window.LoaderXhrData[n]=100,i=""===(i=i||"")?"text":i;try{if("json"===i)throw new Error("Unspported response type 'json'");return await e.loadResource(n,i,(e=>{s&&s(100,e)}))}catch(t){const i="ERR! Can't download "+n+", status: "+t.status+", context: "+t.message;throw e.module.log(i),e.module.onerror&&e.module.onerror(i),t}}Object.defineProperty(n,"__esModule",{value:!0}),n.initLegacyModuleFunctions=n.initLegacyEnvironment=void 0,n.initLegacyEnvironment=function(e){window.GpxHost=e.host,window.Module=e.module,window.LoaderXhr=class{constructor(t,n){!async function(e,t,n){const i=""===n.responseType?"text":n.responseType;try{if("json"===i)throw new Error("Unspported response type 'json'");if("POST"===n.method)throw new Error("Unspported method 'POST'");const s=await e.loadResource(t,i,(e=>{n.progress&&n.progress(100,e)}));n.success&&n.success(s,"http")}catch(i){const s="ERR! Can't download "+t+", status: "+i.status+", context: "+i.message;throw n.fail&&n.fail(t,i.statu,i.message),e.log(s),i}}(e,t,n)}},window.LoaderXhrData={}},n.initLegacyModuleFunctions=function(e){e.module.loadFile=i.bind(e.module,e),e.module.loadResource=s.bind(e.module,e),void 0===e.module.FS&&(e.module.FS={});const t=["createPath","createPreloadedFile","createDataFile","cwd","chdir","createLazyFile","createDevice","readFile","writeFile","unlink"];for(const n of t)if("function"!=typeof e.module.FS[n]){const t=typeof e.module.FS[n];if("undefined"!==t)throw new Error("Unexpected type of FS."+n+" ("+t+")");e.module.FS[n]=function(){const t="FS_"+n;if("function"!=typeof e.module[t])throw new Error(t+" is not exported");return e.module[t](...arguments)}}}},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Exceptions=void 0;const i="gpx_exceptions_",s="gpx_exceptions_delayed";n.Exceptions=class{exceptions={};pushIntervalId=0;endpoint;projectInfo;storage;runtimeInfo;log(){console.log(...arguments)}constructor(e,t,n){this.endpoint=e.exceptions,this.storage=t,this.log=n,this.projectInfo=this.getProjectInfo(e),this.runtimeInfo={mainReady:!1},this.caniuseExceptions()&&(window.addEventListener("error",this.onErrorEvent.bind(this)),this.exceptions=this.loadDelayedExceptionsFromStorage(),this.schedulePushExceptions())}async pushError(e){if(!this.caniuseExceptions())return;const t={url:window.location.href,lineNumber:1,columnNumber:1,message:e.name+" "+e.message,stack:e.stack??"Error without stack"},n=await this.getExceptionInfo(t);n.error.stack=e.stack?.substring(0,65536),this.pushException(n)}async push(e){if(0!==e.length&&this.caniuseExceptions()){for(const t of e){const e=await this.getExceptionInfo({url:window.location.href,lineNumber:1,columnNumber:1,message:t.name+":"+t.message,stack:t.stack??"Errors without stack"});this.existInStorage(e)||(this.exceptions[e.hashCode]=e,this.saveExceptionToStorage(e))}0!==Object.keys(this.exceptions).length&&this.tryPushExceptionsImmediately()}}pushException(e){this.existInStorage(e)||(this.exceptions[e.hashCode]=e,this.saveExceptionToStorage(e),this.tryPushExceptionsImmediately())}caniuseExceptions(){try{return void 0!==this.endpoint&&void 0!==this.storage&&"undefined"!=typeof crypto&&void 0!==crypto.subtle}catch{return!1}}getProjectInfo(e){return void 0!==e?{name:e.name,projectVersion:e.version,engineVersion:e.engineVersion,symbolsVersion:e.symbols}:{name:"unloaded-module",projectVersion:"",engineVersion:""}}getExceptionInfo(e){return new Promise((t=>{const n=JSON.stringify({projectInfo:this.projectInfo,message:e.message}),i=(new TextEncoder).encode(n);crypto.subtle.digest("SHA-256",i).then((n=>{const i=(new TextDecoder).decode(n);let s="";for(let e=0;e<i.length;e++)s+=i.charCodeAt(e).toString(16);t({hashCode:s.toUpperCase(),error:{message:e.message.toString().substring(0,65536),url:e.url,lineNumber:e.lineNumber,columnNumber:e.columnNumber,stack:e.stack?.substring(0,65536)},projectInfo:this.projectInfo,runtimeInfo:this.runtimeInfo})})).catch((e=>{this.log(e)}))}))}async onErrorEvent(e){const t={url:e.filename,lineNumber:e.lineno,columnNumber:e.colno,message:e.message,stack:"ErrorEvent without stack"};if(void 0!==e.error&&null!==e.error)if(t.message+=" Details: "+e.error.name+":"+e.error.message,void 0!==e.error.stack)t.stack=e.error.stack;else{const e=new Error;t.stack="[Faked stack] "+e.stack}this.getExceptionInfo(t).then(this.pushException.bind(this))}tryPushExceptionsImmediately(){0===this.pushIntervalId&&(this.schedulePushExceptions(),this.pushExceptions())}schedulePushExceptions(){0!==Object.keys(this.exceptions).length&&0===this.pushIntervalId&&(this.pushIntervalId=setInterval(this.pushExceptions.bind(this),3e4))}pushExceptions(){const e=Object.keys(this.exceptions);if(0===e.length)return void this.log("WARN! PUSH EXCEPTIONS(0) - Ok");const t=JSON.stringify({exceptions:this.exceptions,systemInfo:window.GpxHost}),n=new XMLHttpRequest;n.open("POST",this.endpoint),n.setRequestHeader("Content-type","application/json"),n.send(t),n.onreadystatechange=t=>{4===n.readyState&&(200!==n.status?this.log(`ERR! CAN'T UPLOAD EXCEPTIONS ON SERVER: ${n.responseText}`):this.log(`WARN! PUSH EXCEPTIONS(${e.length}) - Ok`),this.removeSentExceptionsFromDelayed(e),e.map((e=>{delete this.exceptions[e]})))}}existInStorage(e){const t=i+e.hashCode;return null!==this.storage.getItem(t)}loadDelayedExceptionsFromStorage(){const e={},t=this.storage.getItem(s);if(!t)return e;const n=JSON.parse(t);for(const t of n){const n=this.storage.getItem(i+t);if(!n)continue;const s=JSON.parse(n);e[s.hashCode]=s}return e}saveExceptionToStorage(e){const t=i+e.hashCode;this.storage.setItem(t,JSON.stringify(e));const n=this.storage.getItem(s),o=n?JSON.parse(n):[];o.length>64?this.log("ERR! DELAYED EXCEPTIONS HAS EXCEED THE MAXIMUM ALLOWED: 64"):(o.push(e.hashCode),this.storage.setItem(s,JSON.stringify(o)))}removeSentExceptionsFromDelayed(e){const t=this.storage.getItem(s),n=(t?JSON.parse(t):[]).filter((t=>-1===e.indexOf(t)));this.storage.setItem(s,JSON.stringify(n))}}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DirectImages=void 0;n.DirectImages=class{module;init(e,t,n,i,s){this.module=e,this.module.log("WARN! Images will be loaded using: image direct")}load(e,t,n){const i=this.module._malloc(n+1);this.module.stringToUTF8(t,i,n+1),this.module._gpxLoadTextureAsync(e,i),this.module._free(i)}runNextTask(e){}}},{}],6:[function(e,t,n){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.getImageInfo=n.ImageType=void 0,function(e){e[e.webp=0]="webp",e[e.png=1]="png",e[e.jpeg=2]="jpeg"}(i||(n.ImageType=i={})),n.getImageInfo=function(e){const{data:t,pathToKey:n,log:i}=e,s=t.split("\n"),o=Number.parseInt(s[0],10),r={};for(let e=0;e<o;++e){const t=s[2*e+1],o=n(t),a=s[2*e+1+1].split(" "),d="1"===a[2],l=Number.parseInt(a[3],10),u=Number.parseInt(a[4],10),h=!d||0===l&&0===u?void 0:{width:l,height:u},c={name:o,path:t,width:Number.parseInt(a[0],10),height:Number.parseInt(a[1],10),preview:h,sync:"1"===a[5],async:"1"===a[6],format:Number.parseInt(a[7],10),asyncFormat:Number.parseInt(a[8],10),mipmap:"1"===a[9]};void 0!==r[o]&&i("WARN! Overwriting imageInfo["+o+"]","found in",r[o].path,"and",t),r[o]=c}return r}},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ReversePriorityQueue=void 0;n.ReversePriorityQueue=class{data=[];isEmpty(){return 0==this.data.length}enqueue(e,t){if(0!==this.data.length){for(let n=0;n<this.data.length;n++)if(this.data[n].priority<e)return void this.data.splice(n,0,{priority:e,element:t});this.data.push({priority:e,element:t})}else this.data.push({priority:e,element:t})}dequeue(){return this.data.pop().element}peek(){return 0==this.data.length?void 0:this.data[this.data.length-1].element}}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Binder=void 0;const i=e("./memory"),s=e("../reverse-priority-queue"),o=e=>e&&0==(e&e-1),r=new Uint8ClampedArray([0,0,0,0]);n.Binder=class{module;gl;webGLVersion;textures;toBind;binded;updateQueue=new s.ReversePriorityQueue;updateTimeLimit;constructor(e,t,n,i,s,o){this.module=e,this.gl=t,this.webGLVersion=n,this.textures=i,this.toBind=s,this.updateTimeLimit=o,this.binded={}}addToQueue(e,t,n,i,s,o,r,a){this.updateQueue.enqueue(s,{name:e,path:t,width:n,height:i,size:s,mipmap:o,bytesPerPixel:r,data:a})}runTasks(){const e=Date.now();for(;;){const t=this.updateQueue.peek();if(void 0===t)break;const n=this.getNextTextureId(t.name);if(void 0!==n){if(this.bindTexture(n,t),Date.now()-e>this.updateTimeLimit)break}else i.memory.free(t.size),this.updateQueue.dequeue(),delete this.binded[t.name],--this.toBind[t.name],0===this.toBind[t.name]&&this.textures.end(t.name)}}getNextTextureId(e){const t=this.textures.getTextureIds(e);if(0!==t.length)for(const n of t){if(void 0===this.binded[e])return this.binded[e]=[n],n;if(-1===this.binded[e].indexOf(n))return this.binded[e].push(n),n}}bindTexture(e,t){const n=this.module.GL.textures[e];n?this.doBindTexture(n,t.width,t.height,t.bytesPerPixel,t.data,t.mipmap,t.path):this.module.log("WARN! Texture "+e+" deleted")}bindTransparentTexture(e){const t=this.module.GL.textures[e];t?this.doBindTexture(t,1,1,4,r,!1,"transparent"):this.module.log("WARN! Texture "+e+" not found")}doBindTexture(e,t,n,i,s,r,a){const d=this.gl,l=d.getParameter(d.TEXTURE_BINDING_2D);e!==l&&d.bindTexture(d.TEXTURE_2D,e);const u=d.UNSIGNED_BYTE,h=4===i?d.RGBA:d.RGB,c=h===d.RGB?1:4,m=d.getParameter(d.UNPACK_ALIGNMENT);c!==m&&d.pixelStorei(d.UNPACK_ALIGNMENT,c),d.texImage2D(d.TEXTURE_2D,0,h,t,n,0,h,u,s),r&&(2===this.webGLVersion||o(t)&&o(n)?d.generateMipmap(d.TEXTURE_2D):this.module.log("ERR! Can't generate mipmap for image: "+a+" not power of 2: "+t+"x"+n)),c!==m&&d.pixelStorei(d.UNPACK_ALIGNMENT,m),e!==l&&d.bindTexture(d.TEXTURE_2D,l)}}},{"../reverse-priority-queue":7,"./memory":10}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Loader=void 0;const i=e("./memory"),s=e("../reverse-priority-queue");n.Loader=class{module;worker;textures;baseUrl;localQueue=new s.ReversePriorityQueue;remoteQueue=new s.ReversePriorityQueue;lastNormalTasksRun=0;normalTasksRunTimeLimit;constructor(e,t,n,s,o,r,a){this.module=e,this.worker=t,this.baseUrl=n.baseUrl+"/async/",this.textures=s,this.normalTasksRunTimeLimit=o,this.worker.onmessage=e=>{const t=e.data;if(void 0!==t.error)return this.module.log("ERR! Can't decode image"+t.name+": "+t.error),i.memory.free(t.size),void a(new Error(t.error));r(t.name,t.width,t.height,t.size,t.bytesPerPixel,t.data)},this.worker.onerror=e=>{this.module.log("ERR! Can't decode image. Error: "+e.message),a(e.error)}}loadLocalImage(e){const t=e.preview?.width??e.width,n=e.preview?.height??e.height;this.addImageToQueue(e.name,e.path,t,n,e.format,!1,this.localQueue)}loadRemoteImage(e){this.addImageToQueue(e.name,e.path,e.width,e.height,e.asyncFormat,e.mipmap,this.remoteQueue)}addImageToQueue(e,t,n,s,o,r,a){const d=n*s*4;d>i.memory.limit()?this.module.log("ERR! Can't load texture: "+t+". Size: "+d+". Expected: "+i.memory.limit()+"."):a.enqueue(d,{path:t,name:e,width:n,height:s,size:d,format:o,mipmap:r})}runTasks(e){this.lastNormalTasksRun=Date.now(),this.runNormalTaskProcessing(),e&&this.runLowTaskProcessing()}canRunNextTask(e){const t=e.peek();return void 0!==t&&t.size<=i.memory.unused()}runNormalTaskProcessing(){if(!this.canRunNextTask(this.localQueue))return;if(Date.now()-this.lastNormalTasksRun>this.normalTasksRunTimeLimit)return;const e=this.localQueue.dequeue();if(0===this.textures.getTextureIds(e.name).length)return void this.module.log("WARN! Skipped to load "+e.name);i.memory.alloc(e.size);const t=this.module.FS.readFile(e.path),n={command:"decode",name:e.name,format:e.format,size:e.size,width:e.width,height:e.height,data:t};this.worker.postMessage(n,[n.data.buffer]),this.runNormalTaskProcessing()}async runLowTaskProcessing(){if(!this.localQueue.isEmpty()||!this.canRunNextTask(this.remoteQueue))return;const e=this.remoteQueue.dequeue();if(0===this.textures.getTextureIds(e.name).length)return void this.module.log("WARN! Skipped to load async "+e.name);i.memory.alloc(e.size);const t={command:"load",name:e.name,format:e.format,size:e.size,width:e.width,height:e.height,url:this.baseUrl+e.path};this.worker.postMessage(t),this.runLowTaskProcessing()}}},{"../reverse-priority-queue":7,"./memory":10}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.memory=void 0;n.memory=new class{module;memoryLimit=0;memoryUsed=0;lastReportTime=0;limit(){return this.memoryLimit}used(){return this.memoryUsed}unused(){return this.memoryLimit-this.memoryUsed}init(e,t){this.module=e,this.memoryLimit=t}alloc(e){if(this.memoryLimit<this.memoryUsed+e)throw new Error("Memory buffer overflow");this.memoryUsed+=e,this.report()}free(e){this.memoryUsed-=e,this.memoryUsed<0&&(this.memoryUsed=0),this.report()}report(){Date.now()-this.lastReportTime<1e3||0===this.memoryUsed||(this.lastReportTime=Date.now(),this.module.log("Memory usage "+(this.memoryUsed/1024/1024).toFixed(2)+" Mb / "+(this.memoryLimit/1024/1024).toFixed(0)+" Mb"))}}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Textures=void 0;n.Textures=class{module;textures;constructor(e){this.module=e,this.textures={}}contains(e){return void 0!==this.textures[e]}add(e,t){if(void 0===this.textures[e])return this.textures[e]={},void(this.textures[e][t]=t);void 0===this.textures[e][t]&&(this.textures[e][t]=t)}getTextureIds(e){if(void 0===this.textures[e])return[];for(const t of Object.values(this.textures[e]))this.module.GL.textures[t]||delete this.textures[e][t];return Object.values(this.textures[e])}end(e){this.contains(e)?delete this.textures[e]:this.module.log("ERR! Try remove unavailable texture")}}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.unityImagePathToKey=n.defaultImagePathToKey=n.WorkerImages=void 0;const i=e("../image-info"),s=e("./loader"),o=e("./binder"),r=e("./memory"),a=e("./textures");function d(e){return e}function l(e){const t=e.split("/");return t[t.length-1].split(".")[0]}n.WorkerImages=class{module;worker;imagesInfo;loader;binder;textures;toBind={};constructor(e){this.worker=e}init(e,t,n,u,h){this.module=e,this.module.log("Images will be loaded using: image worker ["+t.imageLoaderType+"]");const c=1024*("Safari"===t.systemInfo.browser&&t.systemInfo.mobile?32:64)*1024;r.memory.init(e,c),this.textures=new a.Textures(e);const m=8.333333333333334;this.loader=new s.Loader(e,this.worker,t,this.textures,m,this.update.bind(this),h),this.binder=new o.Binder(e,n,u,this.textures,this.toBind,m);const p=this.module.FS.readFile("gpx.resources",{encoding:"utf8"});this.imagesInfo=(0,i.getImageInfo)({data:p,pathToKey:"unity"===this.module.origin?l:d,log:this.module.log})}runNextTask(e){this.loader.runTasks(e),this.binder.runTasks()}load(e,t){const n=this.imagesInfo[t];void 0!==n?(this.textures.contains(t)||((void 0!==n.preview||n.sync)&&(this.loader.loadLocalImage(n),this.toBind[t]=(this.toBind[t]??0)+1),n.async&&(this.loader.loadRemoteImage(n),this.toBind[t]=(this.toBind[t]??0)+1)),this.binder.bindTransparentTexture(e),this.textures.add(t,e)):this.module.log("ERR! Can't find image info for texture: ",t,"known images",Object.keys(this.imagesInfo))}update(e,t,n,i,s,o){if(void 0===o)return void this.module.log("ERR! Can't update image: "+e);const r=this.imagesInfo[e];this.binder.addToQueue(e,r.path,t,n,i,r.mipmap,s,o)}},n.defaultImagePathToKey=d,n.unityImagePathToKey=l},{"../image-info":6,"./binder":8,"./loader":9,"./memory":10,"./textures":11}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loadingInfo=void 0;const i="\n        #loading {\n            position: absolute;\n            left: 0;\n            top: 0;\n            bottom: 0;\n            right: 0;\n            z-index: 999;\n            display: flex;\n            flex-direction: column;\n            align-content: center;\n            justify-content: center;\n        }\n        \n        .loading-spinner {\n            position:relative;\n            margin:auto;\n            width: 250px;\n            height: 250px;\n            display: inline-block;\n            overflow: hidden;\n            background: none;\n        }\n\n        .loading-spinner-items {\n            position: absolute;\n            top: 50px;\n            bottom: 50px;\n            left: 50px;\n            right: 50px;\n            width: 150px;\n            height: 150px;\n            transform: translateZ(0) scale(1);\n            backface-visibility: hidden;\n            transform-origin: 0 0;\n        }\n        .loading-spinner-items div { \n            box-sizing: content-box; \n        }\n        @keyframes loading-spinner-items {\n            0% { opacity: 1 }\n            100% { opacity: 0 }\n        }\n        .loading-spinner-items div {\n            left: 62.5px;\n            top: 2.5px;\n            position: absolute;\n            animation: loading-spinner-items linear 0.9174311926605504s infinite;\n            width: 25px;\n            height: 25px;\n            border-radius: 6.75px / 6.75px;\n            transform-origin: 12.5px 72.5px;\n        }\n        .loading-spinner-items .loading-spinner-item-1 {\n            transform: rotate(0deg);\n            animation-delay: -0.8340283569641368s;\n            background: #00e579;\n        }\n        .loading-spinner-items .loading-spinner-item-2 {\n            transform: rotate(32.72727272727273deg);\n            animation-delay: -0.7506255212677231s;\n            background: #00d2d9;\n        }\n        .loading-spinner-items .loading-spinner-item-3 {\n            transform: rotate(65.45454545454545deg);\n            animation-delay: -0.6672226855713094s;\n            background: #007dff;\n        }\n        .loading-spinner-items .loading-spinner-item-4 {\n            transform: rotate(98.18181818181819deg);\n            animation-delay: -0.5838198498748958s;\n            background: #00e579;\n        }\n        .loading-spinner-items .loading-spinner-item-5 {\n            transform: rotate(130.9090909090909deg);\n            animation-delay: -0.5004170141784821s;\n            background: #00d2d9;\n        }\n        .loading-spinner-items .loading-spinner-item-6 {\n            transform: rotate(163.63636363636363deg);\n            animation-delay: -0.4170141784820684s;\n            background: #007dff;\n        }\n        .loading-spinner-items .loading-spinner-item-7 {\n            transform: rotate(196.36363636363637deg);\n            animation-delay: -0.3336113427856547s;\n            background: #00e579;\n        }\n        .loading-spinner-items .loading-spinner-item-8 {\n            transform: rotate(229.0909090909091deg);\n            animation-delay: -0.25020850708924103s;\n            background: #00d2d9;\n        }\n        .loading-spinner-items .loading-spinner-item-9 {\n            transform: rotate(261.8181818181818deg);\n            animation-delay: -0.16680567139282734s;\n            background: #007dff;\n        }\n        .loading-spinner-items .loading-spinner-item-10 {\n            transform: rotate(294.54545454545456deg);\n            animation-delay: -0.08340283569641367s;\n            background: #00e579;\n        }\n        .loading-spinner-items .loading-spinner-item-11 {\n            transform: rotate(327.27272727272725deg);\n            animation-delay: 0s;\n            background: #00d2d9;\n        }\n\n        .loading-progress {\n            position: absolute;\n            top: 50px;\n            bottom: 50px;\n            left: 50px;\n            right: 50px;\n            width: 150px;\n            height: 150px;\n            margin-left: 6px;\n            margin-top: 2px;\n            display: flex;\n            flex-direction: column;\n            align-content: center;\n            justify-content: center;\n        }\n\n        .running-progress {\n            position: absolute;\n            top: 200px;\n            width: 100%;\n            height: 50px;\n            display: flex;\n            flex-direction: column;\n            align-content: center;\n            justify-content: center;\n        }\n\n        .loading-text {\n            color: white;\n            display: block;\n            text-align: center;\n            font-weight: bold;\n            text-shadow: -1px 0 7px rgba(6, 29, 98, 0.30), \n                         0 1px 7px rgba(6, 29, 98, 0.30), \n                         1px 0 7px rgba(6, 29, 98, 0.30), \n                         0 -1px 7px rgba(6, 29, 98, 0.30);\n        }\n        .loading-progress span {\n            font-size: 24px;\n        }\n        .running-progress span {\n            font-size: 16px;\n        }\n",s='\n        <div class="loading-spinner">\n            <div class="loading-spinner-items">\n                <div class="loading-spinner-item-1"></div>\n                <div class="loading-spinner-item-2"></div>\n                <div class="loading-spinner-item-3"></div>\n                <div class="loading-spinner-item-4"></div>\n                <div class="loading-spinner-item-5"></div>\n                <div class="loading-spinner-item-6"></div>\n                <div class="loading-spinner-item-7"></div>\n                <div class="loading-spinner-item-8"></div>\n                <div class="loading-spinner-item-9"></div>\n                <div class="loading-spinner-item-10"></div>\n                <div class="loading-spinner-item-11"></div>\n            </div>\n            <div class="loading-progress">\n                <span class="loading-text"></span>\n            </div>\n            <div class="running-progress">\n                <span class="loading-text"></span>\n            </div>\n        </div>\n';n.loadingInfo=new class{defaultDuration=3e4;loading;loadingText;runningText;hideTimeout=500;reportedPercent=0;intervalId=-1;startedAt;stoppedAt;phrasesTimes=4;phrases=["Checking data","Checking runtime","Initializing services","Preparing the environment","Starting the game"];constructor(){const e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),e.appendChild(t),this.loading=document.createElement("div"),this.loading.id="loading",this.loading.innerHTML=s,document.body.appendChild(this.loading),this.loadingText=document.querySelector(".loading-progress span"),this.runningText=document.querySelector(".running-progress span")}updateProgress(e){++this.reportedPercent;const t=Math.round((Date.now()-this.startedAt)/e);this.reportedPercent=Math.max(this.reportedPercent,t),this.reportedPercent<100?this.loadingText.innerHTML=this.reportedPercent+"%":(this.loadingText.innerHTML="99%",this.reportedPercent=0,clearInterval(this.intervalId),this.intervalId=setInterval((()=>this.updateText()),1e3))}updateText(){this.loadingText.innerHTML="";const e=Math.min(Math.trunc(this.reportedPercent/this.phrasesTimes),this.phrases.length-1);let t=this.phrases[e]+"&nbsp;";const n=this.reportedPercent%this.phrasesTimes;for(let e=0;e<this.phrasesTimes;++e)t+=e<n?".":"&nbsp;";this.runningText.innerHTML=t,++this.reportedPercent}start(e){this.loading.style.display="",this.loadingText.innerHTML="",this.runningText.innerHTML="",this.reportedPercent=0,this.startedAt=Date.now(),this.stoppedAt=0;const t=e<=0?this.defaultDuration/100:Math.min(e,this.defaultDuration)/100;this.updateProgress(t),this.intervalId=setInterval((()=>this.updateProgress(t)),t)}stop(){this.stoppedAt=Date.now()+this.hideTimeout,setTimeout((()=>{this.loadingText.innerHTML="",this.runningText.innerHTML="",clearInterval(this.intervalId),this.loading.style.display="none"}),this.hideTimeout)}getDuration(){return this.startedAt>0&&this.stoppedAt>0&&this.startedAt<this.stoppedAt?this.stoppedAt-this.startedAt:null}}},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.logcalls=void 0;let i=0;n.logcalls={init:(e,t,n)=>{const i=e.env||{};if(void 0===n.logcalls){const e=()=>{};return i.logcall=e,i.wipedcall=e,void(t.wipedcall=e)}const o=Date.now()+"."+1e3*Math.random(),r=n.name+"@"+n.symbols+function(e){if(e&&e.length>0)return"."+e;return""}(n.engineVersion);s(i,t,n.logcalls,o,r)}};const s=(e,t,n,s,o)=>{const r=n+"/put?seed="+s+"&game="+o,a={};let d=0,l=null,u={};const h=()=>{!function(e,t,n){const s=Object.keys(n),o=s.length;if(0===o||i===o)return void e.log("WARN! PUSHCALLS(0) - Ok");i=o,e.log(`WARN! PUSHCALLS(${i}) - PLEASE WAIT`);const r=JSON.stringify(n),a=new XMLHttpRequest;a.open("POST",t),a.setRequestHeader("Content-type","application/json"),a.send(r),a.onreadystatechange=t=>{4===a.readyState&&200===a.status&&e.log(`WARN! PUSHCALLS(${i}) - Ok, new - `+JSON.parse(a.responseText).added)}}(t,r,a)};(function(e,t){return e.log("WARN! DEBUG RUNTIME! DONWLOADING CALL STATS"),new Promise((e=>{const n=new XMLHttpRequest;n.open("GET",t),n.onreadystatechange=t=>{if(4===n.readyState&&200===n.status){const t=JSON.parse(n.responseText).json;delete t.buckets,e(t)}},n.send()}))})(t,n+"/get?game="+o).then((e=>{l=e,g(),t.log("DEBUG RUNTIME READY!"),h(),setInterval(h,15e3)}));const c=e=>{null!=l?e in l||(a[e]=a[e]+1||1):u[e]=u[e]+1||1},m=e=>{0===d||p(e)||(clearInterval(d),d=0,t.log("ERR! Profile bundle doesn't supported on backend side.\nPUSHCALLS will not be called!")),c(e),t.log(`ERR! wasmName: ${e} was wiped out`)};e.logcall=c,e.wipedcall=m,t.wipedcall=m;const p=e=>"number"==typeof e||"string"==typeof e&&/^\d+$/.test(e),g=()=>{if(null!=u){let e=0;Object.keys(u).forEach((t=>{const n=Number.parseInt(t,10);n in l||(a[n]=u[n],e++)})),t.log(`ADDED ${e} DEFFERED CALLS`),u=null}}}},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Metrics=void 0;n.Metrics=class{startedAt=Date.now();metrics={};localMetrics={};endpoint;projectInfo;constructor(e){this.endpoint=e.metrics,this.projectInfo={name:e.name,version:e.version,symbols:e.symbols,engineVersion:e.engineVersion}}push(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.metrics[e]={value:t,unit:n}}pushLocal(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.push(e,t,n),this.localMetrics[e]=1}pushTiming(e,t){this.push(e,t,"ms")}pushLocalTiming(e,t){this.pushTiming(e,t),this.localMetrics[e]=1}send(e){return new Promise(((t,n)=>{if(!this.endpoint)return void n(new Error("Forbidden to send metrics from this host"));const i={browser:e.systemInfo.browser,browserVersion:e.systemInfo.browserVersion,mobile:e.systemInfo.mobile,os:e.systemInfo.os,osVersion:e.systemInfo.osVersion,gpu:e.systemInfo.gpu,deviceModel:e.systemInfo.deviceModel,useCache:e.indexedDbSupported,imageLoader:e.imageLoaderType},s={};for(const e of Object.keys(this.metrics)){const t=this.metrics[e];void 0===this.localMetrics[e]&&t.value&&(s[e]=t.value)}const o=JSON.stringify({metrics:s,projectInfo:this.projectInfo,systemInfo:i}),r=new XMLHttpRequest;r.open("POST",this.endpoint,!0),r.setRequestHeader("Content-type","application/json"),"function"==typeof r.addEventListener&&r.addEventListener("error",(e=>{n(new Error("Invalid xhr response. Code: "+r.status+"status: "+r.statusText+" url: "+this.endpoint))})),r.onreadystatechange=()=>{if(4===r.readyState){if(200!==r.status)return void n(new Error("Invalid xhr response. Code: "+r.status+"status: "+r.responseText+" url: "+this.endpoint));t("WARN! PUSH METRICS - OK")}},r.send(o)}))}report(e,t){let n=`\n\tLocation: ${location.href}`;n+=`\n\tProject: ${this.projectInfo.name}`,n+=`@${this.projectInfo.version}.${this.projectInfo.engineVersion}\n`;const i={width:e.canvas.width,height:e.canvas.height},s={width:e.width,height:e.height},o=Math.round(s.width/s.height*100)/100;n+=`\tRender buffer: ${Math.round(i.width)}x${Math.round(i.height)}\n`,n+=`\tCanvas: ${Math.round(s.width)}x${Math.round(s.height)} (${o})`,n+=` dpi: ${e.devicePixelRatio}\n`,n+=`\n\tHost: ${JSON.stringify(t,null,"\t")}\n`,n+="\n\tMetrics:\n";for(const[e,t]of Object.entries(this.metrics))void 0===this.localMetrics[e]&&(n+=`\t\t${e}: ${t.value} ${t.unit}\n`);return n}}},{}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.clampRenderBufferSize=n.getRenderBufferSize=void 0;const i=960;n.getRenderBufferSize=function(e){if(!function(e){if("unity"!==e.config.origin)return!0;const t=e.config.engineVersion.split("."),n=Number.parseInt(t[0],10),i=Number.parseInt(t[1],10);return n>2021||2021===n&&i>1}(e))return e.log("WARN! Engine does not support High-DPI dislays, forcing to full width & height"),{dpi:1,width:e.frameInfo.width,height:e.frameInfo.height,matchWebGLToCanvasSize:!0};const t=Math.min(window.devicePixelRatio,2),n=Math.max(e.frameInfo.width,e.frameInfo.height)*t;if(n>i){const s=i/n,o=e.frameInfo.width*s,r=e.frameInfo.height*s;return e.log(`WARN! Canvas size is too big, resized from ${e.frameInfo.width*t}x${e.frameInfo.height*t} to ${o*t}x${r*t}`),{dpi:t,width:o,height:r,matchWebGLToCanvasSize:false}}return{dpi:t,width:e.frameInfo.width,height:e.frameInfo.height,matchWebGLToCanvasSize:false}},n.clampRenderBufferSize=function(e,t,n){const s={width:e*n,height:t*n},o=Math.max(s.width,s.height);if(o>i){const e=i/o;return{width:s.width*e,height:s.height*e}}return s}},{}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SDK=void 0;const storage_1=require("./storage/storage"),wasm_1=require("./wasm"),webgl_1=require("./webgl"),webgl_2=require("./wrappers/webgl"),deprecated_1=require("./deprecated"),compression_1=require("./compression"),aspect_1=require("./aspect"),render_buffer_size_1=require("./render-buffer-size"),arl_1=require("./wrappers/arl"),logcalls_1=require("./logcalls"),split_1=require("./split"),exceptions_1=require("./exceptions"),metrics_1=require("./metrics"),loading_info_1=require("./loading-info"),unity_requests_1=require("./wrappers/unity-requests"),unity_screen_orientation_1=require("./wrappers/unity-screen-orientation"),video_1=require("./video"),worker_images_1=require("./images/worker/worker-images"),direct_images_1=require("./images/direct/direct-images");class SDK{tinyLoader;config;host;storage;canvas;GL;exceptions;metrics;images;frameInfo;module={};loadResourceFn;tinyLoaderLoadResourceCopy;constructor(e){switch(this.tinyLoader=e,this.config=e.config,this.host=e.host,this.storage=new storage_1.LStorage(window.GamePix?.localStorage,this.config.name.toLowerCase()+"."),this.log=this.log.bind(this),this.metrics=new metrics_1.Metrics(this.config),this.exceptions=new exceptions_1.Exceptions(this.config,this.storage,this.log),this.loadResourceFn=this.tinyLoader.loadResource.bind(this.tinyLoader),this.loadResource=this.loadResource.bind(this),this.tinyLoaderLoadResourceCopy=this.tinyLoader.loadResource,this.tinyLoader.loadResource=async()=>{throw new Error("Do not use tinyLoader.loadResource use sdk.loadResource instead")},this.host.wasmSupportLevel()){case"not-supported":throw new Error("Web assembly not supported, can't start the game");case"partial":"ru"===this.host.systemInfo.language?alert("Ð’Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ ÑƒÑÑ‚Ð°Ñ€ÐµÐ²ÑˆÑƒÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð° Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€.\nÐœÑ‹ Ð½Ðµ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½ÑƒÑŽ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ð¸Ð³Ñ€Ñ‹."):alert("You are using an outdated version of browser. Please, update your browser.\nWe do not guarantee the correct work of the game.")}if(this.canvas=document.getElementById("canvas"),null===this.canvas)throw new Error("Can't create sdk instance without canvas#canvas");this.initFrame(),this.resizeFrame=this.resizeFrame.bind(this),window.addEventListener("resize",this.resizeFrame);const t=this.storage.getItem("gpxRunTime");let n=loading_info_1.loadingInfo.defaultDuration;if(null!==t)try{n=Number.parseInt(t,10)||n}catch(e){this.log("ERR! Can't parse loading time from local storage",e)}loading_info_1.loadingInfo.start(n)}async init(){this.GL=await(0,webgl_1.getWebGLContext)(this.log,this.canvas,this.config,window.GamePix?.maxWebGLVersion),this.host.updateWebGLInfo(this.GL.context,this.GL.version),(0,deprecated_1.initLegacyEnvironment)(this)}exit(){if(window.removeEventListener("resize",this.resizeFrame),this.tinyLoader.loadResource=this.tinyLoaderLoadResourceCopy,delete this.tinyLoaderLoadResourceCopy,"function"==typeof this.module._forceExit)try{this.module._forceExit()}catch(e){this.log("WARN! forceExit",e)}}log(){this.tinyLoader.log(...arguments)}async loadResource(e,t,n){return(0,compression_1.canUseCompressionForUrl)(e)&&(e=await(0,compression_1.changeToCompressedUrl)(this,e)),this.loadResourceFn(e,t,n)}async load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wbin",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bin.data";delete this.load,this.initModule(this.module);let n=this.loadFiles(e,t);const i=this.instantiateData(n);await this.instantiateModule(n,i),n=void 0,"boolean"!=typeof window.canRunLowTasks&&(window.canRunLowTasks=!0),this.module._testkit_async_setCanRunLowTasks(window.canRunLowTasks);this.module.origin=this.config.origin,this.images.init(this.module,this.host,this.GL.context,this.GL.version,(e=>{this.exceptions.pushError(e)})),this.module.loadTexture=this.images.load.bind(this.images),this.module.video=new video_1.Video(this.module,this.host),this.runModule()}initModule(e){return"function"!=typeof e.log&&(e.log=this.log.bind(this)),void 0===e.ls&&(e.ls=this.storage),void 0===e.loading&&(e.loading=e=>{this.log("Loading: "+e+"%")}),e.onresize=this.resizeFrame.bind(this),e.mainReady=this.mainReady.bind(this),e.print=this.module.log,e.printErr=this.module.log,e.setStatus=()=>{},e.canvas=this.canvas,e.setInterval=setInterval.bind(window),e.clearInterval=clearInterval.bind(window),e.setTimeout=setTimeout.bind(window),e.clearTimeout=clearTimeout.bind(window),e.preRun=e.preRun??[],e.postRun=e.postRun??[],e.webglContextAttributes=this.host.systemInfo.webglContextAttributes,e.noInitialRun=!0,e.noImageDecoding=!0,e.noAudioDecoding=!0,webgl_2.WebGLWrapper.applyToContext(this.GL.context,e,"unity"===this.config.origin,this.GL.version),e.stringToBuffer=(e,t)=>{const n=this.module.lengthBytesUTF8(e)+1,i=this.module._malloc(n);this.module.stringToUTF8(e,i,n),t(i),this.module._free(i)},e.idle=()=>{if(void 0!==e._image_direct2_idle)return e._image_direct2_idle()},e.tick=this.tick.bind(this),e.pushException=this.exceptions.pushError.bind(this.exceptions),(0,deprecated_1.initLegacyModuleFunctions)(this),e}loadFiles(e,t){const n=t+"._.wasm",i=t+".js",s=e+"._.wasm",o=e+".js";let r=0,a=0,d=-1;const l=()=>{const e=Math.max(0,Math.min(100,Math.round((a+r)/2)));void 0!==this.module.loading&&d<e&&(this.module.loading(e),d=e)};return{wasmFile:s,data:this.loadResource(n,"arraybuffer",(e=>{r=e,l()})),dataJs:this.loadResource(i,"text"),wasm:this.loadResource(s,this.host.wasmStreaming?"response":"arraybuffer",(e=>{a=e,l()})),wasmJs:this.loadResource(o,"text")}}async instantiateData(files){const data=await files.data,dataJs=await files.dataJs;this.module.getPreloadedPackage=(e,t)=>data;const Module=this.module;eval(dataJs)}instantiateModule(e,t){return new Promise(((n,i)=>{this.module.onRuntimeInitialized=n,this.module.instantiateWasm=async(n,s)=>{try{return await this.instantiateWasm(e,n,(async(e,n)=>{try{return await t,s(e,n)}catch(e){throw i(e),e}}))}catch(e){throw this.log("ERR! Unable to instantiate wasm, will not run"),this.log(JSON.stringify(e)),i(e),e}},e.wasmJs.then((e=>{new Function(["Module"],e)(this.module)})).catch(i)}))}async initJSEnvironment(e){if("unity"!==this.config.origin)return;unity_requests_1.unityRequestsWrapper.init(e,this.module),unity_screen_orientation_1.unityScreenOrientationWrapper.init(e,this.module),arl_1.arl.init(e,this.module),logcalls_1.logcalls.init(e,this.module,this.config);const t=new split_1.Split(this);await t.init(e)}async instantiateWasm(e,t,n){let i;await this.initJSEnvironment(t);let s=await e.wasm;try{i=await(0,wasm_1.wasmInstantiate)(this,s,t)}catch(n){if(!(s instanceof Response))throw n;s=await this.loadResource(e.wasmFile,"arraybuffer"),i=await(0,wasm_1.wasmInstantiate)(this,s,t)}return this.metrics.pushTiming("compileTime",i.compileTime),this.metrics.pushTiming("instantiateTime",i.instantiateTime),this.metrics.push("instantiateStream","stream"===i.instantiateType?1:0),n(i.instance,i.wasmModule)}runModule(){var e=this;this.module.progress=()=>{},this.module.run();const t=function(){const t=[e.host.systemInfo.width+"",e.host.systemInfo.height+""];for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];for(const e of i)t.push(e+"");e.module.argv=t;try{e.log("main("+JSON.stringify(t)+")")}catch(n){e.log("main(",t,")")}e.module.callMain(t)};if(this.module.ready){const n=function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return setTimeout((()=>{t.apply(e,i)}),0)};return this.module.ready(n)}return setTimeout(t,0)}async mainReady(e,t,n,i,s,o,r){this.log("mainReady"),loading_info_1.loadingInfo.stop();const a=loading_info_1.loadingInfo.getDuration();null!==a&&this.storage.setItem("gpxRunTime",a.toString()),this.metrics.pushTiming("runTime",Date.now()-this.metrics.startedAt);const d=this.storage.getItem("gpxRuns"),l=null===d?1:Number.parseInt(d,10)+1;this.storage.setItem("gpxRuns",l.toString()),this.metrics.push("runs",l),this.metrics.push("gamepixSdkUndefinedMain",void 0===window.GamePix?1:0),this.exceptions.runtimeInfo.mainReady=!0,this.exceptions.runtimeInfo.runs=l,this.log(this.metrics.report(this.module,this.host));try{const e=await this.metrics.send(this.host);this.log(e)}catch(e){this.log("ERR! "+e)}}resizeCanvas(e,t,n,i){const s=this.canvas;s.style.position="relative",s.style.top=t/2+"px",s.style.left=e/2+"px",s.style.marginTop=i/2*-1+"px",s.style.marginLeft=n/2*-1+"px",s.style.width=n+"px",s.style.height=i+"px"}initFrame(){const e={orientation:this.config.runtime.orientation,aspect:this.config.runtime.aspect},t=this.config.runtime.aspectRanges??(void 0!==e.orientation&&null!=e.aspect&&Array.isArray(e.aspect)?(()=>{const t=Math.min(...e.aspect),n=Math.max(...e.aspect);return"landscape"===e.orientation?{landscape:{min:t,max:n}}:{portrait:{min:t,max:n}}})():void 0),n=(0,aspect_1.getAspectRatio)(t,window.innerWidth,window.innerHeight),i=(0,aspect_1.getSizeWithAspectRatio)(window.innerWidth,window.innerHeight,n);this.frameInfo={aspectRanges:t,responsive:this.config.runtime.responsive??!1,aspect:n,width:i.width,height:i.height};const{dpi:s,width:o,height:r,matchWebGLToCanvasSize:a}=(0,render_buffer_size_1.getRenderBufferSize)(this);this.frameInfo.width=o*s,this.frameInfo.height=r*s,this.module.dpi=s,this.module.width=o,this.module.height=r,this.module.devicePixelRatio=s,this.host.systemInfo.width=this.frameInfo.width,this.host.systemInfo.height=this.frameInfo.height,this.module.matchWebGLToCanvasSize=a,this.resizeCanvas(window.innerWidth,window.innerHeight,this.frameInfo.width,this.frameInfo.height),this.canvas.width=this.frameInfo.width,this.canvas.height=this.frameInfo.height}resizeFrame(){this.frameInfo.responsive&&(this.frameInfo.aspect=(0,aspect_1.getAspectRatio)(this.frameInfo.aspectRanges,window.innerWidth,window.innerHeight));const{width:e,height:t}=(0,aspect_1.getSizeWithAspectRatio)(window.innerWidth,window.innerHeight,this.frameInfo.aspect);if(this.resizeCanvas(window.innerWidth,window.innerHeight,e,t),this.frameInfo.responsive){const n=(0,render_buffer_size_1.clampRenderBufferSize)(e,t,this.module.dpi);this.canvas.width=n.width,this.canvas.height=n.height}this.frameInfo.width=e,this.frameInfo.height=t}tick(){this.images.runNextTask(window.canRunLowTasks)}}exports.SDK=SDK;const globalTinyLoader=window.tinyLoader;void 0!==globalTinyLoader&&(globalTinyLoader.run.push((async()=>{const e=new SDK(globalTinyLoader);await e.init(),e.images=void 0!==globalTinyLoader.imageLoader?new worker_images_1.WorkerImages(globalTinyLoader.imageLoader):new direct_images_1.DirectImages,window.sdk=e})),globalTinyLoader.postRun.push((async()=>{void 0!==globalTinyLoader.errors&&(window.sdk.exceptions.push(globalTinyLoader.errors),delete globalTinyLoader.errors)})),globalTinyLoader.stop.push((async()=>{window.sdk.exit(),delete window.sdk})))},{"./aspect":1,"./compression":2,"./deprecated":3,"./exceptions":4,"./images/direct/direct-images":5,"./images/worker/worker-images":12,"./loading-info":13,"./logcalls":14,"./metrics":15,"./render-buffer-size":16,"./split":18,"./storage/storage":20,"./video":21,"./wasm":22,"./webgl":23,"./wrappers/arl":24,"./wrappers/unity-requests":25,"./wrappers/unity-screen-orientation":26,"./wrappers/webgl":27}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Split=void 0;n.Split=class{splitBinaryPromise;splitMetaPromise;splitBinary=new Uint8Array(0);splitMeta={};cache={};internalModule;constructor(e){this.splitBinaryPromise=e.loadResource("wsplit._.js","arraybuffer").then((e=>new Uint8Array(e))),this.splitMetaPromise=e.loadResource("wsplit.js","text").then(JSON.parse),this.internalModule=e}async init(e){try{[this.splitBinary,this.splitMeta]=await Promise.all([this.splitBinaryPromise,this.splitMetaPromise])}catch(e){return void this.internalModule.log("WARN! Can't load split wasm")}return e.placeholder=new Proxy(this,{get:function(e,t){return e.splitModuleHandler(t)}}),e}splitModuleHandler(e){var t=this;const n=this.internalModule.module;return function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];if(void 0!==t.cache[e])return void t.cache[e].apply(null,s);n.wipedcall(e);const[r,a]=t.splitMeta[e],d=t.splitBinary.subarray(r,r+a),l=new WebAssembly.Module(d),u=new WebAssembly.Instance(l,{primary:n.asm});return t.cache[e]=u.exports.fn,t.cache[e].apply(null,s)}}}},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MemStorage=void 0;n.MemStorage=class{length=0;storage={};setItem(e,t){this.storage[e]=t,this.length=Object.keys(this.storage).length}getItem(e){const t=this.storage[e];return void 0===t?null:t}removeItem(e){delete this.storage[e],this.length=Object.keys(this.storage).length}key(e){const t=Object.keys(this.storage);return void 0===t[e]?null:t[e]}clear(){this.length=0,this.storage={}}}},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LStorage=void 0;const i=e("./mem-storage");n.LStorage=class{backend;length;prefix;constructor(e,t){this.prefix=t;try{this.backend=e||localStorage,this.testBackend()}catch(e){this.backend=new i.MemStorage}this.length=this.backend.length,"function"==typeof this.backend.sync&&(this.sync=e=>{this.backend.sync(e)})}testBackend(){const e=this.prefix+".test.record";this.backend.setItem(e,"123");const t=this.backend.getItem(e);this.backend.removeItem(e);if(!("123"===t&&null===this.backend.getItem(e)))throw new Error("Storage backend is not working properly")}setLocalStoragePrefix(e){this.prefix=e}clear(){if(!this.backend.length)return;const e=[];for(let t=0;t<this.backend.length;++t){const n=this.backend.key(t);n&&n.startsWith(this.prefix)&&e.push(n)}for(const t of e)this.backend.removeItem(t);this.length=this.backend.length}key(e){return this.backend.key(e)}setItem(e,t){if(!t||void 0===t.length||0===t.length)return void this.writeStringToKey(e,"");let n=0;for(;n<t.length;){let i=t.substr(n,1024);n+=i.length,n<t.length&&(i+="@"),this.writeStringToKey(e,i),e+="."}}getItem(e){let t=this.readStringFromKey(e);if(null===t)return null;if(0===t.length)return t;for(;"@"===t[t.length-1];){t=t.substr(0,t.length-1),e+=".";const n=this.readStringFromKey(e);t+=null===n?"":n}return t}removeItem(e){this.backend.removeItem(this.prefix+e),this.length=this.backend.length}writeStringToKey(e,t){this.backend.setItem(this.prefix+e,t),this.length=this.backend.length}readStringFromKey(e){return this.backend.getItem(this.prefix+e)}}},{"./mem-storage":19}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Video=void 0;const i=e("./aspect");n.Video=class{videoPlayer;skipButton;module;baseUrl;aspect;resizeObserver;constructor(e,t){this.module=e,this.baseUrl=t.baseUrl+"/async/",this.resizeObserver=new ResizeObserver((e=>{if(0===e.length)return;const t=e[0].contentBoxSize[0];void 0!==t&&this.setSkipButtonPosition(t.inlineSize,t.blockSize)}))}mount(){void 0===this.videoPlayer&&(this.videoPlayer=document.createElement("video"),this.videoPlayer.controls=!1,this.videoPlayer.playsInline=!0,this.videoPlayer.setAttribute("style",s),this.resizeObserver.observe(this.videoPlayer),document.body.appendChild(this.videoPlayer),this.videoPlayer.addEventListener("canplay",this.startPlay.bind(this),!1),this.videoPlayer.addEventListener("ended",this.endVideo.bind(this),!1),this.videoPlayer.addEventListener("error",this.stopVideo.bind(this),!1),this.videoPlayer.addEventListener("aborted",this.stopVideo.bind(this),!1),this.videoPlayer.addEventListener("loadedmetadata",this.loadMetaData.bind(this),!1)),void 0===this.skipButton&&(this.skipButton=document.createElement("button"),this.skipButton.innerText="SKIP",this.skipButton.setAttribute("style",o),this.skipButton.style.display="none",document.body.appendChild(this.skipButton),this.skipButton.addEventListener("click",this.endVideo.bind(this),!1),setTimeout((()=>{this.showSkipButton()}),1e3))}play(e){const t=this.module.UTF8ToString(e),n=this.baseUrl+t;this.mount(),this.aspect=window.innerWidth/window.innerHeight,this.videoPlayer.src=n,this.videoPlayer.play().catch((e=>{this.module.log("ERR! Can't play video: "+e)}))}pause(){void 0!==this.videoPlayer&&this.videoPlayer.pause()}resume(){void 0!==this.videoPlayer&&this.videoPlayer.play().catch((e=>{this.module.log("ERR! Can't resume video: "+e)}))}showSkipButton(){""!==this.skipButton.style.display&&(this.skipButton.style.display="",this.setSkipButtonPosition(window.innerWidth,window.innerHeight))}startPlay(){this.showSkipButton()}endVideo(){this.unmount(),this.module._callVideoEndedCallback()}stopVideo(){this.unmount(),this.module._callVideoErrorCallback()}loadMetaData(){this.aspect=this.videoPlayer.videoWidth/this.videoPlayer.videoHeight}setSkipButtonPosition(e,t){if(void 0===this.skipButton)return;const n=(0,i.getSizeWithAspectRatio)(e,t,this.aspect),s=this.skipButton.getBoundingClientRect(),o=Math.min(n.height/s.height,s.height);this.skipButton.style.marginBottom=t/2-n.height/2+2*o+"px",this.skipButton.style.marginRight=e/2-n.width/2+"px"}unmount(){void 0!==this.videoPlayer&&(this.resizeObserver.unobserve(this.videoPlayer),this.videoPlayer.remove(),delete this.videoPlayer),void 0!==this.skipButton&&(this.skipButton.remove(),delete this.skipButton)}};const s="\n    position: absolute;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    background: #000000;\n    z-index: 999;\n",o="\n    position: absolute;\n    bottom: 0;\n    right: 0;\n    width: 110px;\n    height: 40px;\n    text-align: center; \n    border-radius: 5px;\n    border-color: #000000;\n    background: #000000;\n    background-color: #000000;\n    color: #ffffff;\n    z-index: 9999;\n    cursor: pointer;\n"},{"./aspect":1}],22:[function(e,t,n){"use strict";function i(e,t,n){e.log("Try instaniate WASM from buffer");const i=Date.now();return WebAssembly.compile(t).then((e=>{const t=Date.now()-i,s=Date.now();return WebAssembly.instantiate(e,n).then((n=>({wasmModule:e,instance:n,compileTime:t,instantiateTime:Date.now()-s,instantiateType:"array"})))}))}function s(e,t){const n=void 0!==t?"\tStreamingError:\t"+t.message:"";return{name:"wasm_instantiate_failed: "+e.name,message:e.message+n,stack:e.stack}}Object.defineProperty(n,"__esModule",{value:!0}),n.wasmInstantiate=void 0,n.wasmInstantiate=async function(e,t,n){if(t instanceof Response)try{const i=await async function(e,t,n){e.log("Try instantiate WASM from stream");const i=Date.now();return WebAssembly.instantiateStreaming(t,n).then((e=>({wasmModule:e.module,instance:e.instance,compileTime:0,instantiateTime:Date.now()-i,instantiateType:"stream"})))}(e,t,n);return i}catch(o){const r=function(e,t){const n={};e.headers?.forEach(((e,t)=>{n[t]=e}));const i={sourceType:typeof e,instanceOfResponse:e instanceof Response,ok:e.ok,status:e.status,statusText:e.statusText,type:e.type,headers:n};return{name:"wasm_instantiate_stream_failed: "+t.name,message:t.message,stack:"Details: "+JSON.stringify(i,null,4)+"\nStack:\n"+t.stack}}(t,o);try{e.log("ERR! Can't instantiate WASM from stream:\n"+r.message+"\n"+r.stack);const s=await i(e,await t.arrayBuffer(),n);return await e.exceptions.pushError(r),s}catch(t){throw e.log("ERR! Can't instantiate WASM:\n"+t),s(t,r)}}else try{return await i(e,t,n)}catch(t){throw e.log("ERR! Can't instantiate WASM:\n"+t.name),s(t)}}},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getWebGLContext=void 0;const i={2:{type:"webgl2",description:"WebGL 2.0",majorVersion:2},1:{type:"webgl",description:"WebGL 1.0",majorVersion:1},0:{type:"experimental-webgl",description:"WebGL 1.0 FALLBACK",majorVersion:1}},s=3,o=`webgl-factory.v${s}: `,r={alpha:!1,antialias:!1,depth:!0,explicitSwapControl:0,failIfMajorPerformanceCaveat:!1,majorVersion:1,minorVersion:0,powerPreference:"high-performance",preferLowPowerToHighPerformance:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,proxyContextToMainThread:0,renderViaOffscreenBackBuffer:0,stencil:!0,maxWebGLVersion:2};n.getWebGLContext=function(e,t,n,a){if(void 0!==n.webglAttributes)for(const e of Object.keys(n.webglAttributes))r[e]=n.webglAttributes[e];"number"==typeof a&&(r.maxWebGLVersion=a);let d=0,l=()=>{};function u(){clearTimeout(d);const n=function(e,t){for(let n=r.maxWebGLVersion;n>=0;--n){const a=i[n];if(void 0===a){e("ERR! "+o+"Unable to find description for context: "+a+"\nAttributes:\n"+JSON.stringify(r,null,2));continue}const d=t.getContext(a.type,r);if(null!=d)return d.contextType=a,r.majorVersion=a.majorVersion,e(o+a.description+" context created\nAttributes:\n"+JSON.stringify(r,null,2)),{factoryVersion:s,context:d,version:a.majorVersion};e("ERR! "+o+"Unable to create context: "+a.description)}return void e("ERR! Attributes:\n"+JSON.stringify(r,null,2))}(e,t);void 0===n||n.context.isContextLost()||(d=setTimeout((()=>l(n)),150))}function h(t){clearTimeout(d),e("ERR! "+o+"webglcontextcreateionerror: "+t.statusMessage||"?",t)}function c(t){clearTimeout(d),t.preventDefault(),e("ERR! "+o+"webglcontextlost: "+t.statusMessage||"?",t)}function m(){u(),e("ERR! "+o+"webglcontextrestored")}return t.addEventListener("webglcontextcreationerror",h,!1),t.addEventListener("webglcontextlost",c,!1),t.addEventListener("webglcontextrestored",m,!1),new Promise((e=>{l=e,u()})).then((n=>(function(e,t,n){t.getContext=t=>{for(const s of Object.values(i))if(s.type===t){if(s.majorVersion===n.version)return e(o+"Get WebGL context: "+t+". Force use pre-created WebGL context"),n.context;break}return e("ERR! "+o+"Unable to get context: "+t+"\nAttributes:\n"+JSON.stringify(r,null,2)),null}}(e,t,n),t.removeEventListener("webglcontextcreationerror",h,!1),t.removeEventListener("webglcontextlost",c,!1),t.removeEventListener("webglcontextrestored",m,!1),n)))}},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.arl=void 0;class i{keyLength=32;keyOffset=5;soundsDurations={};module;loadedSoundNames=[];channels=[];init(e,t){n.arl.module=t;const i=e.env||{};i._JS_Sound_Init=n.arl.soundInit,i._JS_Sound_ReleaseInstance=n.arl.releaseSound,i._JS_Sound_Load_PCM=n.arl.loadSoundPCM,i._JS_Sound_Load=n.arl.loadSound,i._JS_Sound_Create_Channel=n.arl.createChannel,i._JS_Sound_Play=n.arl.play,i._JS_Sound_SetLoop=n.arl.setLoop,i._JS_Sound_Set3D=n.arl.set3D,i._JS_Sound_Stop=n.arl.stopPlay,i._JS_Sound_SetPosition=n.arl.setPosition,i._JS_Sound_SetVolume=n.arl.setVolume,i._JS_Sound_SetPitch=n.arl.setPitch,i._JS_Sound_SetListenerPosition=n.arl.setListenerPosition,i._JS_Sound_SetListenerOrientation=n.arl.setListenerOrientation,i._JS_Sound_GetLoadState=n.arl.getLoadState,i._JS_Sound_ResumeIfNeeded=n.arl.resumeIfNeeded,i._JS_Sound_GetLength=n.arl.getLength,i._JS_Sound_SetListenerPosition=n.arl.getLoadState}soundInit(){}releaseSound(e){}loadSoundPCM(e,t,n,i){throw new Error("JS_Sound_Load_PCM is not implemented")}loadSound(e,t){if(n.arl.module.HEAPU8.buffer.length<t+n.arl.keyOffset+n.arl.keyLength)throw new Error("Pointer to audio file is out of range: "+e);const i=new Uint8Array(n.arl.module.HEAPU8.buffer,e,n.arl.keyLength+n.arl.keyOffset);if(64===i[0]&&97===i[1]&&114===i[2]&&108===i[3]&&58===i[4]){const t=new Uint8Array(n.arl.module.HEAPU8.buffer,e+n.arl.keyOffset,n.arl.keyLength),i=new TextDecoder("utf-8").decode(t);return n.arl.loadedSoundNames.push(i)-1}throw new Error("Pointer doesn't contains audio name: "+e)}createChannel(e,t){const i={id:-1,sound:{id:-1,pitch:1},volume:1,_3d:0,listener:{position:{x:0,y:0,z:0}},callback:e};return n.arl.channels.push(i)-1}resetChannel(e){e.id=-1,e.sound={id:-1,pitch:1}}play(e,t,i,s){const o=()=>{const i=n.arl.channels[t];n.arl.resetChannel(i),i.sound.name=n.arl.loadedSoundNames[e],n.arl.tryPlay(i)};0!==s?setTimeout(o,s):o()}tryPlay(e){const t=e.sound;if(void 0===t.name||void 0===t.loop||t.id>=0)return;const i=n.arl.module._gpxGetFreeSoundChannel();-1!==i&&(e.id=i,n.arl.module._gpxSetSoundVolume(e.id,e.volume),n.arl.module.stringToBuffer(t.name,(i=>{t.id=n.arl.module._gpxPlaySound(i,t.loop,t.pitch,e.id)})))}setLoop(e,t){const i=n.arl.channels[e];i.sound.loop!==t&&(i.sound.loop=t,n.arl.tryPlay(i))}setLoopPoints(e,t,n){}set3D(e,t){const i=n.arl.channels[e];i._3d!==t&&(i._3d=t)}stopPlay(e,t){const i=()=>{const t=n.arl.channels[e];t.id>=0&&n.arl.module._gpxStopSound(t.id),n.arl.resetChannel(t)};0!==t?setTimeout(i,t):i()}setPosition(e,t,i,s){const o=n.arl.channels[e],r={x:t,y:i,z:s};void 0!==o.position?o.position.x===t&&o.position.y===i&&o.position.z===s||(o.position=r,n.arl.changePosition()):o.position=r}setVolume(e,t){const i=n.arl.channels[e];i.volume!==t&&(i.volume=t,i.id>=0&&n.arl.module._gpxSetSoundVolume(i.id,t))}setPitch(e,t){const i=n.arl.channels[e];i.sound.pitch!==t&&(i.sound.pitch=t,n.arl.tryPlay(i))}setListenerPosition(e,t,i){for(const s of n.arl.channels){const o=s.listener.position;void 0!==o&&o.x===e&&o.y===t&&o.z===i||(s.listener.position={x:e,y:t,z:i},n.arl.changePosition())}}setListenerOrientation(e,t,i,s,o,r){for(const a of n.arl.channels){const d=a.listener.orientation;void 0!==d&&d.x===-e&&d.y===-t&&d.z===-i&&d.xUp===s&&d.yUp===o&&d.zUp===r||(a.listener.orientation={x:-e,y:-t,z:-i,xUp:s,yUp:o,zUp:r},n.arl.changePosition())}}getLoadState(e){return 0}resumeIfNeeded(){n.arl.module._gpxResumeSounds()}getLength(e){const t=n.arl.loadedSoundNames[e];if(void 0!==n.arl.soundsDurations[t])return n.arl.soundsDurations[t];n.arl.module.stringToBuffer(t,(e=>{const i=n.arl.module._gpxGetSoundDuration(e);return n.arl.soundsDurations[t]=i,i}))}changePosition(){}}n.default=i,n.arl=new i},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.unityRequestsWrapper=void 0,n.unityRequestsWrapper={init:(e,t)=>{!function(e,t){const n="StreamingAssets",i={instances:{},nextRequestId:0},s=e=>t.UTF8ToString(e),o=e=>{const t=e.split(n);return t.length<=1?e:t.join("async/"+n)+".js"};e._JS_SystemInfo_GetStreamingAssetsURL=(e._JS_SystemInfo_GetStreamingAssetsURL?.bind(e),(e,i)=>(e&&t.stringToUTF8(n,e,i),t.lengthBytesUTF8(n))),e._JS_WebRequest_Create=(e._JS_WebRequest_Create?.bind(e),(e,n)=>{const r=o(s(e)),a=s(n),d=t.companyName&&t.productName&&t.XMLHttpRequest?new t.XMLHttpRequest({companyName:t.companyName,productName:t.productName,cacheControl:t.cacheControl(r)}):new XMLHttpRequest;return d.open(a,r,!0),d.responseType="arraybuffer",i.instances[i.nextRequestId]=d,i.nextRequestId++}),e._JS_WebRequest_SetTimeout=(e._JS_WebRequest_SetTimeout?.bind(e),(e,t)=>{i.instances[e].timeout=t}),e._JS_WebRequest_SetRequestHeader=(e._JS_WebRequest_SetRequestHeader?.bind(e),(e,t,n)=>{const o=s(t),r=s(n);i.instances[e].setRequestHeader(o,r)}),e._JS_WebRequest_SetResponseHandler=(e._JS_WebRequest_SetResponseHandler?.bind(e),(e,n,s)=>{const o=i.instances[e];function r(e,i){if(s){const r=t.lengthBytesUTF8(e)+1,a=t._malloc(r);t.stringToUTF8(e,a,r),t.dynCall("viiiiii",s,[n,o.status,0,0,a,i]),t._free(a)}}o.onload=e=>{if(s){const e=0,i=new Uint8Array(o.response);if(0!=i.length){const r=t._malloc(i.length);t.HEAPU8.set(i,r),t.dynCall("viiiiii",s,[n,o.status,r,i.length,0,e])}else t.dynCall("viiiiii",s,[n,o.status,0,0,0,e])}},o.onerror=e=>{r("Unknown error.",2)},o.ontimeout=e=>{r("Connection timed out.",14)},o.onabort=e=>{r("Aborted.",17)}}),e._JS_WebRequest_SetProgressHandler=(e._JS_WebRequest_SetProgressHandler?.bind(e),(e,n,s)=>{i.instances[e].onprogress=e=>{s&&e.lengthComputable&&t.dynCall("viii",s,[n,e.loaded,e.total])}}),e._JS_WebRequest_Send=(e._JS_WebRequest_Send?.bind(e),(e,n,s)=>{const o=i.instances[e];try{if(s>0){const e=t.HEAPU8.subarray(n,n+s);o.send(e)}else o.send()}catch(e){t.log("ERR!"+e.name+": "+e.message)}}),e._JS_WebRequest_GetResponseHeaders=(e._JS_WebRequest_GetResponseHeaders?.bind(e),(e,n,s)=>{const o=i.instances[e].getAllResponseHeaders();return n&&t.stringToUTF8(o,n,s),t.lengthBytesUTF8(o)}),e._JS_WebRequest_GetStatusLine=(e._JS_WebRequest_GetStatusLine?.bind(e),(e,n,s)=>{const o=i.instances[e].status+" "+i.instances[e].statusText;return n&&t.stringToUTF8(o,n,s),t.lengthBytesUTF8(o)}),e._JS_WebRequest_Abort=(e._JS_WebRequest_Abort?.bind(e),e=>{i.instances[e].abort()}),e._JS_WebRequest_Release=(e._JS_WebRequest_Release?.bind(e),e=>{let t=i.instances[e];t.onload=null,t.onerror=null,t.ontimeout=null,t.onabort=null,t=null,i.instances[e]=null})}(e.env||{},t)}}},{}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.unityScreenOrientationWrapper=void 0,n.unityScreenOrientationWrapper={init:(e,t)=>{const n=e.env||{};n._JS_ScreenOrientation_Init=()=>{},n._JS_ScreenOrientation_DeInit=()=>{},n._JS_ScreenOrientation_Lock=()=>{t?.log("ERR! Screen orientation change is not supported")}}}},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebGLWrapper=void 0;const i={};["OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","EXT_color_buffer_half_float","WEBGL_color_buffer_float"].forEach((e=>i[e]=!0)),n.WebGLWrapper={applyToContext:(e,t,n,a)=>{void 0===t.preinitializedWebGLContext&&(t.preinitializedWebGLContext=e);const d=[],l=e.getSupportedExtensions();t.log("Validating supported extensions",l),l.forEach((e=>{!0===i[e]?t.log("WARN! Removing blacklisted extension",e):d.push(e)})),e.getSupportedExtensions=()=>d,n&&(2===a?function(e,t){s.defaultWebGL.texStorage2D=e.texStorage2D,s.defaultWebGL.texImage2D=e.texImage2D,s.defaultWebGL.bindTexture=e.bindTexture,e.bindTexture=(u=e.bindTexture.bind(e),(t,n)=>(t===e.TEXTURE_2D&&(null!==s.texStorageInfo&&(s.defaultWebGL.texStorage2D.apply(e,[s.texStorageInfo.target,s.texStorageInfo.levels,s.texStorageInfo.internalformat,s.texStorageInfo.width,s.texStorageInfo.height]),s.texStorageInfo=null),s.activeTexture=n),u(t,n))),e.texImage2D=(l=e.texImage2D.bind(e),function(n,i,a,d,u,h,c,m,p){if(n!==e.TEXTURE_2D||null===s.activeTexture||null==p)return l.apply(e,arguments);if(!o(p,p.byteOffset||0,p.byteLength))return l.apply(e,arguments);r(t,p,p.byteOffset,p.byteLength);const g=new ImageData(1,1);return l.apply(e,[n,i,a,c,m,g])}),e.texStorage2D=(d=e.texStorage2D.bind(e),function(t,n,i,o,r){if(t!==e.TEXTURE_2D||null===s.activeTexture)return d.apply(e,arguments);s.texStorageInfo={target:t,levels:n,internalformat:i,width:o,height:r}}),e.framebufferTexture2D=(a=e.framebufferTexture2D.bind(e),function(t,n,i,o,r){return i!==e.TEXTURE_2D||null===o||null===s.texStorageInfo||(s.defaultWebGL.texStorage2D.apply(e,[s.texStorageInfo.target,s.texStorageInfo.levels,s.texStorageInfo.internalformat,s.texStorageInfo.width,s.texStorageInfo.height]),s.texStorageInfo=null),a.apply(e,arguments)}),e.texSubImage2D=(i=e.texSubImage2D.bind(e),function(n,a,d,l,u,h,c,m,p,g){if(n!==e.TEXTURE_2D||null===s.activeTexture)return i.apply(e,arguments);const f=g||0;if(null==p||!o(p,f))return null!==s.texStorageInfo&&(s.defaultWebGL.texStorage2D.apply(e,[s.texStorageInfo.target,s.texStorageInfo.levels,s.texStorageInfo.internalformat,s.texStorageInfo.width,s.texStorageInfo.height]),s.texStorageInfo=null),i.apply(e,arguments);r(t,p,f);const y=new ImageData(1,1);s.defaultWebGL.texImage2D.apply(e,[n,a,c,c,m,y]),s.texStorageInfo=null}),e.compressedTexSubImage2D=(n=e.compressedTexSubImage2D.bind(e),function(t,i,o,r,a,d,l,u,h,c){return t!==e.TEXTURE_2D||null===s.activeTexture||null===s.texStorageInfo||(s.defaultWebGL.texStorage2D.apply(e,[s.texStorageInfo.target,s.texStorageInfo.levels,s.texStorageInfo.internalformat,s.texStorageInfo.width,s.texStorageInfo.height]),s.texStorageInfo=null),n.apply(e,arguments)});var n;var i;var a;var d;var l;var u}(e,t):function(e,t){e.bindTexture=(i=e.bindTexture.bind(e),(t,n)=>(t===e.TEXTURE_2D&&(s.activeTexture=n),i(t,n))),e.texImage2D=(n=e.texImage2D.bind(e),function(i,a,d,l,u,h,c,m,p){if(i!==e.TEXTURE_2D||null===s.activeTexture||null==p)return n.apply(e,arguments);if(!o(p,p.byteOffset||0,p.byteLength))return n.apply(e,arguments);r(t,p,p.byteOffset,p.byteLength);const g=new ImageData(1,1);return n.apply(e,[i,a,d,c,m,g])});var n;var i}(e,t))},applyToCanvas:(e,t,i)=>{const s=e.getContext;e.getContext=function(){for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];const d=s.apply(e,r),l=r[0],u="webgl2"===l?2:"webgl"===l||"experimental-webgl"===l?1:0;return u>0&&(e.getContext=s,n.WebGLWrapper.applyToContext(d,t,i,u)),d}}};const s={activeTexture:null,defaultWebGL:{},texStorageInfo:null};function o(e,t,n){if(null===s.activeTexture)return!1;const i=new Uint8Array(e.buffer,t,n);return i.length>4&&64===i[0]&&116===i[1]&&114===i[2]&&108===i[3]&&58===i[4]}function r(e,t,n,i){const o=new Uint8Array(t.buffer,n,i);let r=0;for(;0!==o[5+r]&&o.length>5+r;)r++;const a=new TextDecoder("utf-8").decode(new Uint8Array(t.buffer,n+5,r));e.loadTexture(s.activeTexture.name,a,r)}},{}]},{},[17]);